<html>
    <head>
        <title>Oswell's Avatar</title>
        <style>
            canvas{
                border:1px solid black;
            }
            body{
                margin:0;
            }
            #sliders{
                position:absolute;
                top:550;
                left:10;
            }
        </style>
    </head>
    <body>
        <canvas id="myCanvas"></canvas>
        <div id="sliders">
            x: <input type="range" min="-0.75" max="0.75" step="0.1" onChange="updatePoints(this, 'x')"/>
            <br>
            y: <input type="range" min="-0.35" max="0.65" step="0.05" onChange="updatePoints(this, 'y')"/>
        </div>
        <script>
            const canvas=document.getElementById("myCanvas");
            canvas.width=800;
            canvas.height=500; 
            
            const ctx=canvas.getContext("2d");
            ctx.translate(canvas.width/2, canvas.height/2);
            ctx.scale(canvas.width*0.5, canvas.height*0.5);
            ctx.lineWidth=0.005;
            const img=new Image();
            img.src="oswel.avif";

            const skinTone="rgba(219,221,225,0.8)";

            const livePoints={
                A:{x:0, y:-0.040, xRange:[0,0.090], yRange:[-0.040,0.1], xOffset:0, yOffset:0},
                B:{x:0, y:-0.80, xRange:[0,0.03], yRange:[-0.80,-0.785], xOffset:0, yOffset:0},
                C:{x:0, y:0.60, xRange:[0,0.075], yRange:[0.60,0.580], yNegRange:[0.60,0.565], xOffset:0, yOffset:0}
            }

            const {A,B,C} = livePoints;

            img.onload=function(){
                animate();
            }

            canvas.addEventListener("click", getCoords);

            function animate(){
                ctx.clearRect(-1,-1,2,2);
                ctx.globalAlpha=0.2;
                ctx.drawImage(img,-1,-1,2,2);
                ctx.globalAlpha=1;
                drawMe();
                requestAnimationFrame(animate);
            }

            function getCoords(evt) {
                const x = (evt.x-canvas.width/2)/(canvas.width/2);
                const y = (evt.y-canvas.height/2)/(canvas.height/2)
                const offset = {
                    x:x-A.x,
                    y:y-A.y
                }
                console.log(offset.x.toFixed(2)+","+offset.y.toFixed(2));
            }

            function drawMe() {
                drawAxis();
                ctx.strokeStyle = "rgb(76,78,80)";
                drawHead();
                drawBody();
                //drawPoint(A, "A");
                //drawPoint(B, "B");
                //drawPoint(C, "C");
            }

            function drawAxis() {
                // Draw the Axis References.
                ctx.beginPath();
                ctx.strokeStyle = "lightgray";
                // Vertical Line
                ctx.moveTo(B.x, B.y);
                ctx.quadraticCurveTo(A.x,A.y,C.x,C.y);
                // Horizontal Line
                ctx.moveTo(-0.25,-0.040);
                ctx.quadraticCurveTo(A.x,A.y,0.25,-0.040);
                ctx.stroke();
                // 201, 203 207
            }

            function drawHead() {
                ctx.save();
                drawBoundary(B.x, B.y, C.x, C.y);
                ctx.scale(-1,1);
                drawBoundary(-B.x, B.y, -C.x, C.y);
                ctx.restore();

                drawEyes(A);
                drawFaceDetails(A);
                drawNose(A);
                // Drawing Mouth
                
            }

            function drawBoundary(bx, by, cx, cy) {
                // Draw top portion
                ctx.beginPath();
                ctx.moveTo(bx, by);
                ctx.quadraticCurveTo(0.09,-0.77,0.15,-0.70);
                ctx.lineTo(0.15,-0.63);
                ctx.quadraticCurveTo(0.28,-0.41,0.23, -0.040);
                // Draw bottom portion
                ctx.lineTo(0.23,0.06);
                ctx.quadraticCurveTo(0.21,0.18,0.15,0.30);
                ctx.quadraticCurveTo(0.14,0.40,0.10,0.49);
                ctx.quadraticCurveTo(0.07,0.58,cx, cy);

                ctx.stroke();
                ctx.closePath();
                ctx.fillStyle=skinTone;
                ctx.fill();

                ctx.beginPath();
                ctx.moveTo(0.15,0.30);
                ctx.lineTo(0.08+cx*0.15,0.50);        
                ctx.stroke();
            }
            
            function drawFaceDetails(ref) {
                ctx.save();
                ctx.translate(ref.x, ref.y+0.040);
                ctx.beginPath();
                ctx.moveTo(-0.02,-0.04);
                ctx.quadraticCurveTo(0.00,-0.05,0.02,-0.04);
                ctx.moveTo(-0.04,0.02)
                ctx.quadraticCurveTo(0.00,-0.01,0.04,0.02);
                ctx.stroke();

                drawFaceLines(ref.xOffset, ref.yOffset);
                ctx.scale(-1,1);
                drawFaceLines(-ref.xOffset, ref.yOffset);
                ctx.restore();
            }

            function drawFaceLines(xOffset, yOffset) {
                ctx.save();
                const scaleX = Math.max(0,xOffset);
                const scaleY = yOffset;
                ctx.scale(1-scaleX*0.55, 1-Math.abs(scaleY*0.5));
                ctx.beginPath();

                const outerMostPoint={
                    x:0.15 - Math.min(xOffset*0.085, 0),
                    y:-0.70 - Math.max(0, yOffset*0.65)
                }

                ctx.moveTo(outerMostPoint.x,outerMostPoint.y);
                ctx.lineTo(0.13,-0.41);
                ctx.quadraticCurveTo(0.11,-0.28,0.06,-0.17);
                ctx.quadraticCurveTo(0.06,-0.11,0.02,-0.04);
                ctx.lineTo(0.06,0.00);
                ctx.moveTo(0.04,0.06);
                ctx.quadraticCurveTo(0.11,0.17,0.18,0.23);
                ctx.restore();
                ctx.stroke();
                
            }

            function drawEyes(ref) {
                ctx.save();
                ctx.translate(ref.x, ref.y);
                drawEye(Math.max(0,ref.xOffset), ref.yOffset);
                ctx.scale(-1, 1);
                drawEye(Math.max(0,-ref.xOffset), ref.yOffset);
                ctx.restore();
            }

            function drawEye(scaleX, scaleY) {
                ctx.save();
                ctx.scale(1-scaleX*0.34,1-Math.abs(scaleY*0.20));
                ctx.beginPath();
                ctx.moveTo(0.05,0.08);
                ctx.quadraticCurveTo(0.17,0.15,0.20,0.01);
                ctx.quadraticCurveTo(0.13,-0.04,0.05,0.06);
                ctx.lineTo(0.05,0.08);
                ctx.stroke();
                
                ctx.beginPath();
                ctx.fillStyle="rgba(40,147,181,0.3)";
                ctx.moveTo(0.09,0.02);
                ctx.bezierCurveTo(0.08,0.13,0.175,0.10,0.14,-0.005);
                ctx.fill();
                
                ctx.beginPath();
                ctx.arc(0.12,0.04,0.015,0,Math.PI*2);
                ctx.fillStyle="rgba(211,246,252,0.3)";
                ctx.fill();
                ctx.restore();
            }

            function drawNose(ref) {
                ctx.save();
                ctx.scale(1-Math.abs(ref.xOffset)*0.34,1-Math.abs(ref.yOffset*0.20));
                ctx.translate(ref.x, ref.y);
                ctx.beginPath();
                ctx.moveTo(0.00,0.13);

                const tip = {
                    x: ref.xOffset*0.12,
                    y: 0.33
                }
                ctx.quadraticCurveTo(tip.x, tip.y, 0.00,0.335);
                ctx.lineTo(-0.045,0.315);
                ctx.moveTo(0.00,0.335);
                ctx.lineTo(0.045,0.315);
                ctx.stroke();

                ctx.beginPath();
                ctx.strokeStyle="white";
                ctx.moveTo(-0.045,0.315);
                ctx.quadraticCurveTo(-0.07,0.30,-0.05,0.26);

                ctx.moveTo(0.045,0.315);
                ctx.quadraticCurveTo(0.07,0.30,0.05,0.26);
                ctx.stroke();

                ctx.restore();
            }

            function drawBody() {
                ctx.beginPath();
                // Drawing Neck
                ctx.moveTo(-0.07,0.55);
                ctx.quadraticCurveTo(-0.05,0.70,-0.06,0.80);
                ctx.moveTo(0.07,0.55);
                ctx.quadraticCurveTo(0.05,0.70,0.06,0.80);
                ctx.stroke();
            }

            function drawPoint(loc,label,rad=0.04){
                ctx.beginPath();
                ctx.arc(loc.x,loc.y,rad,0,Math.PI*2);
                ctx.stroke();
                ctx.fillStyle="green";
                ctx.fill();
                ctx.fillStyle="white";
                ctx.font=(rad*1.6)+"px Arial";
                ctx.textAlign="center";
                ctx.textBaseline="middle";
                ctx.fillText(label, loc.x, loc.y+rad*0.15);
            }

            function updatePoints(info, attr){
                
                for(let pID in livePoints){
                    const p = livePoints[pID];
                    let yRange = p.yRange;
                    let value = info.value;
                    if(p.yNegRange) {
                        yRange = info.value<0?p.yNegRange:p.yRange;
                        value = Math.abs(value);
                    }
                    switch(attr){
                        case "x":
                            p.xOffset=value;
                            p.x=lerp(p.xRange[0], p.xRange[1],info.value);
                            break;
                        case "y":
                            p.yOffset=value;
                            p.y=lerp(yRange[0], yRange[1],value);
                            break;
                    }
                }
            }

            function lerp(start, end, percentage){
                // Linear Interpolation
                return start+(end-start)*percentage;
            }

        </script>
    </body>
</html>